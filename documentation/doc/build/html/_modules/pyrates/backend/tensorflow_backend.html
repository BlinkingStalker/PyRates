<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>pyrates.backend.tensorflow_backend &mdash; pyrates 0.9.1-dev3 documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../../../_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../../_static/css/spc-extend.css">
    <link rel="stylesheet" href="../../../_static/scipy.css" type="text/css" >
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" >
    <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" >
    <link rel="stylesheet" href="../../../_static/gallery-binder.css" type="text/css" >
    <link rel="stylesheet" href="../../../_static/gallery-dataframe.css" type="text/css" >
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.9.1-dev3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/js/copybutton.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" >
    <link rel="search" title="Search" href="../../../search.html" >
    <link rel="top" title="pyrates 0.9.1-dev3 documentation" href="../../../index.html" >
    <link rel="up" title="Module code" href="../../index.html" > 
  </head>
  <body>

<div class="container">
  <div class="top-scipy-org-logo-header">
    <a href="../../../index.html">
      <img style="border: 0;" alt="pyrates" src="../../../_static/img/pyrates_logo_large.png"></a>
    </div>
  </div>
</div>


    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
	
        <li class="active"><a href="../../../index.html">PyRates</a></li>
	
          <li class="active"><a href="../../index.html" accesskey="U">Module code</a></li> 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="../../../genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
      <li class="active">
        <a href="../../../py-modindex.html" title="Python Module Index"
           >modules</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body">
            
  <h1>Source code for pyrates.backend.tensorflow_backend</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># PyRates software framework for flexible implementation of neural</span>
<span class="c1"># network model_templates and simulations. See also:</span>
<span class="c1"># https://github.com/pyrates-neuroscience/PyRates</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2017-2018 the original authors (Richard Gast and</span>
<span class="c1"># Daniel Rose), the Max-Planck-Institute for Human Cognitive Brain</span>
<span class="c1"># Sciences (&quot;MPI CBS&quot;) and contributors</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;</span>
<span class="c1">#</span>
<span class="c1"># CITATION:</span>
<span class="c1">#</span>
<span class="c1"># Richard Gast and Daniel Rose et. al. in preparation</span>

<span class="sd">&quot;&quot;&quot;Wraps tensorflow such that it&#39;s low-level functions can be used by PyRates to create and simulate a compute graph.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># external imports</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="c1"># pyrates internal imports</span>
<span class="kn">from</span> <span class="nn">.funcs</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.numpy_backend</span> <span class="kn">import</span> <span class="n">NumpyBackend</span><span class="p">,</span> <span class="n">NumpyVar</span><span class="p">,</span> <span class="n">PyRatesIndexOp</span><span class="p">,</span> <span class="n">PyRatesAssignOp</span><span class="p">,</span> <span class="n">PyRatesOp</span><span class="p">,</span> <span class="n">CodeGen</span>

<span class="c1"># meta infos</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Richard Gast&quot;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s2">&quot;development&quot;</span>


<div class="viewcode-block" id="TensorflowVar"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowVar">[docs]</a><span class="k">class</span> <span class="nc">TensorflowVar</span><span class="p">(</span><span class="n">NumpyVar</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for creating variables via a tensorflow-based PyRates backend.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span> <span class="o">+</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">shape</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">),</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">+</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_var</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

<div class="viewcode-block" id="TensorflowVar.squeeze"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowVar.squeeze">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">squeeze</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="n">subclass</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="o">.</span><span class="fm">__subclasscheck__</span><span class="p">(</span><span class="n">subclass</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">NumpyVar</span><span class="o">.</span><span class="fm">__subclasscheck__</span><span class="p">(</span><span class="n">subclass</span><span class="p">)</span></div>


<div class="viewcode-block" id="TensorflowOp"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowOp">[docs]</a><span class="k">class</span> <span class="nc">TensorflowOp</span><span class="p">(</span><span class="n">PyRatesOp</span><span class="p">):</span>

    <span class="n">var_class</span> <span class="o">=</span> <span class="n">TensorflowVar</span>

    <span class="k">def</span> <span class="nf">_generate_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a function from operator value and arguments&quot;&quot;&quot;</span>
        <span class="n">func_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">CodeGen</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;def </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_name</span><span class="si">}</span><span class="s2">(&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op_dict</span><span class="p">[</span><span class="s1">&#39;arg_names&#39;</span><span class="p">]:</span>
            <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_op_dict</span><span class="p">[</span><span class="s1">&#39;arg_names&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">func</span><span class="o">.</span><span class="n">code</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">code</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="s2">&quot;):&quot;</span><span class="p">)</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_linebreak</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_indent</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="s2">&quot;import tensorflow as tf&quot;</span><span class="p">)</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_linebreak</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;return </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_op_dict</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">generate</span><span class="p">(),</span> <span class="nb">globals</span><span class="p">(),</span> <span class="n">func_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func_dict</span>

<div class="viewcode-block" id="TensorflowOp.numpy"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowOp.numpy">[docs]</a>    <span class="k">def</span> <span class="nf">numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluates the return values of the PyRates operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_numerics</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">found</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">found</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">elem</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">elem</span><span class="p">))</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
                <span class="n">found</span> <span class="o">=</span> <span class="n">elem</span> <span class="o">==</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">idx</span></div>


<div class="viewcode-block" id="TensorflowAssignOp"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowAssignOp">[docs]</a><span class="k">class</span> <span class="nc">TensorflowAssignOp</span><span class="p">(</span><span class="n">PyRatesAssignOp</span><span class="p">):</span>

    <span class="n">var_class</span> <span class="o">=</span> <span class="n">TensorflowVar</span>

    <span class="k">def</span> <span class="nf">_generate_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a function from operator value and arguments&quot;&quot;&quot;</span>
        <span class="n">func_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">CodeGen</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;def </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_name</span><span class="si">}</span><span class="s2">(&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op_dict</span><span class="p">[</span><span class="s1">&#39;arg_names&#39;</span><span class="p">]:</span>
            <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_op_dict</span><span class="p">[</span><span class="s1">&#39;arg_names&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">func</span><span class="o">.</span><span class="n">code</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">code</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="s2">&quot;):&quot;</span><span class="p">)</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_linebreak</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_indent</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="s2">&quot;import tensorflow as tf&quot;</span><span class="p">)</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_linebreak</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;return </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_op_dict</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">generate</span><span class="p">(),</span> <span class="nb">globals</span><span class="p">(),</span> <span class="n">func_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func_dict</span>

<div class="viewcode-block" id="TensorflowAssignOp.numpy"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowAssignOp.numpy">[docs]</a>    <span class="k">def</span> <span class="nf">numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluates the return values of the PyRates operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_numerics</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_extract_var_idx</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">results_args</span><span class="p">,</span> <span class="n">results_arg_names</span><span class="p">):</span>

        <span class="k">if</span> <span class="s2">&quot;scatter&quot;</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>

            <span class="c1"># for tensorflow-like scatter indexing</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;short_name&#39;</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">short_name</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
                    <span class="n">var_idx</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">,&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">var_idx</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;__no_name__&quot;</span>
                <span class="n">var_idx</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">,&quot;</span>

            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">results_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">results_arg_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">var_idx</span><span class="p">,</span> <span class="n">results_args</span><span class="p">,</span> <span class="n">results_arg_names</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_extract_var_idx</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">results_args</span><span class="p">,</span> <span class="n">results_arg_names</span><span class="p">)</span></div>


<div class="viewcode-block" id="TensorflowIndexOp"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowIndexOp">[docs]</a><span class="k">class</span> <span class="nc">TensorflowIndexOp</span><span class="p">(</span><span class="n">PyRatesIndexOp</span><span class="p">):</span>

    <span class="n">var_class</span> <span class="o">=</span> <span class="n">TensorflowVar</span>

    <span class="k">def</span> <span class="nf">_generate_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a function from operator value and arguments&quot;&quot;&quot;</span>
        <span class="n">func_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">CodeGen</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;def </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_name</span><span class="si">}</span><span class="s2">(&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op_dict</span><span class="p">[</span><span class="s1">&#39;arg_names&#39;</span><span class="p">]:</span>
            <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_op_dict</span><span class="p">[</span><span class="s1">&#39;arg_names&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">func</span><span class="o">.</span><span class="n">code</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">code</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="s2">&quot;):&quot;</span><span class="p">)</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_linebreak</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_indent</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="s2">&quot;import tensorflow as tf&quot;</span><span class="p">)</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_linebreak</span><span class="p">()</span>
        <span class="n">func</span><span class="o">.</span><span class="n">add_code_line</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;return </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_op_dict</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">generate</span><span class="p">(),</span> <span class="nb">globals</span><span class="p">(),</span> <span class="n">func_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func_dict</span>

<div class="viewcode-block" id="TensorflowIndexOp.numpy"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowIndexOp.numpy">[docs]</a>    <span class="k">def</span> <span class="nf">numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluates the return values of the PyRates operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_numerics</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div></div>


<div class="viewcode-block" id="TensorflowBackend"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowBackend">[docs]</a><span class="k">class</span> <span class="nc">TensorflowBackend</span><span class="p">(</span><span class="n">NumpyBackend</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrapper to tensorflow. This class provides an interface to all tensorflow functionalities that may be accessed</span>
<span class="sd">    via pyrates. All tensorflow variables and operations will be stored in a layered compute graph that can be executed</span>
<span class="sd">    to evaluate the (dynamic) behavior of the graph.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ops</span>
<span class="sd">        Additional operations this backend instance can perform, defined as key-value pairs. The key can then be used in</span>
<span class="sd">        every equation parsed into this backend. The value is a dictionary again, with two keys:</span>
<span class="sd">            1) name - the name of the function/operation (used during code generation)</span>
<span class="sd">            2) call - the call signature of the function including import abbreviations (i.e. `tf.add` for tensorflow&#39;s</span>
<span class="sd">            add function)</span>
<span class="sd">    dtypes</span>
<span class="sd">        Additional data-types this backend instance can use, defined as key-value pairs.</span>
<span class="sd">    name</span>
<span class="sd">        Name of the backend instance. Used during code generation to create a recognizable file structure.</span>
<span class="sd">    float_default_type</span>
<span class="sd">        Default float precision. If no data-type is indicated for a particular variable, this will be used.</span>
<span class="sd">    imports</span>
<span class="sd">        Can be used to pass additional import statements that are needed for code generation of the custom functions</span>
<span class="sd">        provided via `ops`. Will be added to the top of each generated code file.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">ops</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">dtypes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;net_0&#39;</span><span class="p">,</span>
                 <span class="n">float_default_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                 <span class="n">imports</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Instantiates tensorflow backend, i.e. a tensorflow graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">imports</span><span class="p">:</span>
            <span class="n">imports</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;import tensorflow as tf&quot;</span><span class="p">]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ops</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">float_default_type</span><span class="p">,</span> <span class="n">imports</span><span class="p">)</span>

        <span class="c1"># define operations and datatypes of the backend</span>
        <span class="c1">################################################</span>

        <span class="c1"># base math operations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;+&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_add&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.add&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;-&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_subtract&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.subtract&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;*&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_multiply&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.multiply&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;/&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_divide&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.math.divide_no_nan&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;%&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_modulo&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.mod&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;^&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_power&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.pow&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;**&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_power&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.pow&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;@&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_dot&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.matmul&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;.T&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_transpose&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.transpose&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;.I&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_invert&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.invert&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_greater&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.greater&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;&lt;&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_less&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.less&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;==&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_equal&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.equal&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;!=&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_not_equal&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.not_equal&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;&gt;=&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_greater_equal&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.greater_equal&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;&lt;=&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_less_equal&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.less_equal&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;=&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;assign&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;assign&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;+=&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;assign_add&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;assign_add&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;-=&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;assign_subtract&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;assign_sub&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;update&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_update&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;scatter_nd_update&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;update_add&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_update_add&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;scatter_nd_add&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;update_sub&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_update_sub&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;scatter_nd_sub&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;neg&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;negative&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;neg_one&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;sin&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_sin&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.sin&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;cos&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_cos&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.cos&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;tan&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_tan&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.tan&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;atan&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_atan&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.arctan&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;abs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_abs&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.abs&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;sqrt&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_sqrt&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.sqrt&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;sq&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_square&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.square&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;exp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_exp&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.exp&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_max&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.max&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_min&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.min&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;argmax&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_transpose&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.argmax&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;argmin&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_argmin&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.argmin&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_round&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.round&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;sum&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_sum&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.reduce_sum&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_mean&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.reduce_mean&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;concat&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_concatenate&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.concat&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;reshape&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_reshape&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.reshape&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_shape&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.shape&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_dtype&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.dtype&quot;</span><span class="p">},</span>
                         <span class="s1">&#39;squeeze&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_squeeze&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.squeeze&quot;</span><span class="p">},</span>
                         <span class="s1">&#39;expand&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tensorflow_expand&#39;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.expand_dims&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;roll&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_roll&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.roll&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;cast&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_cast&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.cast&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;randn&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_randn&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.randn&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;ones&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_ones&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.ones&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;zeros&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_zeros&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.zeros&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_arange&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.arange&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;softmax&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_softmax&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.softmax&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;sigmoid&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_sigmoid&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.sigmoid&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;tanh&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_tanh&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.tanh&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;pyrates_index&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;pyrates_index&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;gather&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_gather&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.gather&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;gather_nd&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_gather_nd&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.gather_nd&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_mask&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.boolean_mask&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_group&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.group&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;stack&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_stack&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.stack&quot;</span><span class="p">},</span>
                         <span class="s2">&quot;no_op&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;tensorflow_identity&quot;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="s2">&quot;tf.identity&quot;</span><span class="p">},</span>
                         <span class="p">})</span>

        <span class="c1"># base data types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;float16&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span>
                       <span class="s2">&quot;float32&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
                       <span class="s2">&quot;float64&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                       <span class="s2">&quot;int16&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
                       <span class="s2">&quot;int32&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
                       <span class="s2">&quot;int64&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
                       <span class="s2">&quot;uint16&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span>
                       <span class="s2">&quot;uint32&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">uint32</span><span class="p">,</span>
                       <span class="s2">&quot;uint64&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">uint64</span><span class="p">,</span>
                       <span class="s2">&quot;complex64&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
                       <span class="s2">&quot;complex128&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
                       <span class="s2">&quot;bool&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">bool</span>
                       <span class="p">}</span>

<div class="viewcode-block" id="TensorflowBackend.compile"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowBackend.compile">[docs]</a>    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">build_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">decorator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">function</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compile the graph layers/operations. Creates python files containing the functions in each layer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        build_dir</span>
<span class="sd">            Directory in which to create the file structure for the simulation.</span>
<span class="sd">        decorator</span>
<span class="sd">        kwargs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            Contains tuples of layer run functions and their respective arguments.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">build_dir</span><span class="o">=</span><span class="n">build_dir</span><span class="p">,</span> <span class="n">decorator</span><span class="o">=</span><span class="n">decorator</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="TensorflowBackend.broadcast"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowBackend.broadcast">[docs]</a>    <span class="k">def</span> <span class="nf">broadcast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">op2</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>

        <span class="c1"># match data types</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare_dtypes</span><span class="p">(</span><span class="n">op1</span><span class="p">,</span> <span class="n">op2</span><span class="p">):</span>
            <span class="n">op1</span><span class="p">,</span> <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_dtypes</span><span class="p">(</span><span class="n">op1</span><span class="p">,</span> <span class="n">op2</span><span class="p">)</span>

        <span class="c1"># broadcast shapes</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">op1</span><span class="p">,</span> <span class="n">op2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="TensorflowBackend.get_var"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowBackend.get_var">[docs]</a>    <span class="k">def</span> <span class="nf">get_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve variable from graph.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name</span>
<span class="sd">            Identifier of the variable.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NumpyVar</span>
<span class="sd">            Variable from graph.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">name</span><span class="p">[:</span><span class="n">idx</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span></div>

<div class="viewcode-block" id="TensorflowBackend.stack_vars"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowBackend.stack_vars">[docs]</a>    <span class="k">def</span> <span class="nf">stack_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">var_count</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s1">&#39;short_name&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">short_name</span> <span class="ow">in</span> <span class="n">var_count</span><span class="p">:</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">short_name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">var_count</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">short_name</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">var_count</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">short_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="s1">&#39;stack&#39;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">)</span></div>

<div class="viewcode-block" id="TensorflowBackend.add_input_layer"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowBackend.add_input_layer">[docs]</a>    <span class="k">def</span> <span class="nf">add_input_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyVar</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">continuous</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid input structure. The tensorflow backend can only be used with fixed step-size &#39;</span>
                             <span class="s1">&#39;solvers and thus only supports inputs with discrete time steps. Either change the &#39;</span>
                             <span class="s1">&#39;backend or set `continuous` to False.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)):</span>
            <span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">as_numpy_dtype</span><span class="p">),</span> <span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_input_layer</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TensorflowBackend.apply_idx"><a class="viewcode-back" href="../../../backend.html#pyrates.backend.tensorflow_backend.TensorflowBackend.apply_idx">[docs]</a>    <span class="k">def</span> <span class="nf">apply_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">update</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">update_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Applies index to a variable. IF update is passed, variable is updated at positions indicated by index.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var</span>
<span class="sd">            Variable to index/update</span>
<span class="sd">        idx</span>
<span class="sd">            Index to variable</span>
<span class="sd">        update</span>
<span class="sd">            Update to variable entries</span>
<span class="sd">        update_type</span>
<span class="sd">            Type of lhs update (e.g. `=` or `+=`)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Any</span>
<span class="sd">            Updated/indexed variable.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>

            <span class="n">idx_tmp</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">n_indices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_tmp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n_indices</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">args</span><span class="p">:</span>

                <span class="c1"># create boolean mask as index</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx_tmp</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                        <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;numpy&#39;</span><span class="p">):</span>
                        <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">)])</span>

                <span class="n">idx_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                <span class="n">idx_var</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">indices</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">idx_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_var</span><span class="p">(</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_idx&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">idx_var</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_idx</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">idx_var</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">update_type</span><span class="p">)</span>

        <span class="c1"># standard indexing</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_idx</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">update_type</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rhs_func</span><span class="p">,</span> <span class="n">func_args</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dts</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">output_indices</span><span class="p">):</span>

        <span class="n">sampling_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="n">dts</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="c1"># initialize results storage vectors</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">output_indices</span><span class="p">:</span>
            <span class="n">var_dim</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">sampling_steps</span><span class="p">,</span> <span class="n">var_dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_float_def</span><span class="p">)))</span>

        <span class="c1"># solve via pyrates internal explicit euler algorithm</span>
        <span class="n">sampling_idx</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
        <span class="n">sampling_steps</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">dts</span> <span class="o">/</span> <span class="n">dt</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="n">dt</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span><span class="n">rhs_func</span><span class="o">=</span><span class="n">rhs_func</span><span class="p">,</span> <span class="n">func_args</span><span class="o">=</span><span class="n">func_args</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span>
                            <span class="n">sampling_steps</span><span class="o">=</span><span class="n">sampling_steps</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="n">sampling_idx</span><span class="o">=</span><span class="n">sampling_idx</span><span class="p">,</span>
                            <span class="n">output_indices</span><span class="o">=</span><span class="n">output_indices</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">])</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dts</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">times</span><span class="p">,</span> <span class="n">results</span>

    <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rhs_func</span><span class="p">,</span> <span class="n">func_args</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">sampling_steps</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">sampling_idx</span><span class="p">,</span>
             <span class="n">output_indices</span><span class="p">):</span>

        <span class="n">zero</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">state_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">tf</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>

            <span class="n">deltas</span> <span class="o">=</span> <span class="n">rhs_func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state_vars</span><span class="p">,</span> <span class="n">func_args</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
            <span class="n">state_vars</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">deltas</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">tf</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">floormod</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">sampling_steps</span><span class="p">),</span> <span class="n">zero</span><span class="p">):</span>

                <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">output_indices</span><span class="p">):</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">scatter_nd_update</span><span class="p">([[</span><span class="n">sampling_idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">state_vars</span><span class="p">[</span><span class="n">idx</span><span class="p">]])</span>

                <span class="n">sampling_idx</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_create_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vtype</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">var</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">TensorflowVar</span><span class="p">(</span><span class="n">vtype</span><span class="o">=</span><span class="n">vtype</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                  <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">var</span><span class="p">,</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">_create_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;+=&quot;</span><span class="p">,</span> <span class="s2">&quot;-=&quot;</span><span class="p">,</span> <span class="s2">&quot;*=&quot;</span><span class="p">,</span> <span class="s2">&quot;/=&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span><span class="p">:</span>
                    <span class="n">op</span> <span class="o">=</span> <span class="s2">&quot;update&quot;</span>
                <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;+=&quot;</span><span class="p">:</span>
                    <span class="n">op</span> <span class="o">=</span> <span class="s2">&quot;update_add&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">op</span> <span class="o">=</span> <span class="s2">&quot;update_sub&quot;</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
                    <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_update_args</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">TensorflowAssignOp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;call&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">op</span> <span class="ow">is</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;dtype&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;bool&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">TensorflowOp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="s1">&#39;call&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">TensorflowOp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s1">&#39;gather&#39;</span><span class="p">][</span><span class="s1">&#39;call&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s1">&#39;gather&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_idx_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">TensorflowOp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s1">&#39;gather_nd&#39;</span><span class="p">][</span><span class="s1">&#39;call&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="s1">&#39;gather_nd&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">TensorflowIndexOp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;call&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">op</span> <span class="ow">is</span> <span class="s2">&quot;cast&quot;</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;tf.</span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">break</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TensorflowOp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;call&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_process_idx_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Preprocesses the index to a variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># match shape of index to shape</span>
        <span class="c1">###############################</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="s1">&#39;reshape&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>

        <span class="n">shape_diff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="n">idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">shape_diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid index shape. Operation has shape </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s1">, but received an index of &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;length </span><span class="si">{</span><span class="n">idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># manage shape of idx</span>
        <span class="k">if</span> <span class="n">shape_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape_diff</span><span class="p">):</span>
                <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">idx</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="s1">&#39;concat&#39;</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">var</span><span class="p">,</span> <span class="n">idx</span>

    <span class="k">def</span> <span class="nf">_match_dtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">op2</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Match data types of two operators/variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">op1</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">):</span>

            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">op2</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">):</span>

                <span class="c1"># cast both variables to lowest precision</span>
                <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;16&quot;</span><span class="p">,</span> <span class="s2">&quot;32&quot;</span><span class="p">,</span> <span class="s2">&quot;64&quot;</span><span class="p">,</span> <span class="s2">&quot;128&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">op1</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">op1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">op2</span><span class="p">,</span> <span class="n">op1</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">op2</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">op1</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">op2</span>

            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">op2</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">op2</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>

                <span class="c1"># transform op2 into constant tensor with dtype of op1</span>
                <span class="k">return</span> <span class="n">op1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">op2</span><span class="p">),</span> <span class="n">op1</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">op1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">op2</span><span class="p">,</span> <span class="n">op1</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">op2</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">):</span>

            <span class="c1"># transform op1 into constant tensor with dtype of op2</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">op1</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">op2</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">op1</span><span class="p">),</span> <span class="n">op2</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">op2</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">op1</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">op2</span>

        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op1</span><span class="p">,</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">op1</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

            <span class="c1"># cast op2 to numpy dtype of op1</span>
            <span class="k">return</span> <span class="n">op1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">op2</span><span class="p">,</span> <span class="n">op1</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op2</span><span class="p">,</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">op2</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

            <span class="c1"># cast op1 to numpy dtype of op2</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="n">op1</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span> <span class="n">op2</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># cast op2 to dtype of op1 referred from its type string</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_match_dtypes</span><span class="p">(</span><span class="n">op1</span><span class="p">,</span> <span class="n">op2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_is_state_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:0&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_vars</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:0&quot;</span><span class="p">,</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_is_state_var</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_compare_shapes</span><span class="p">(</span><span class="n">op1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">op2</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op1</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op2</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">op1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">op1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">op1</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">op1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op1</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">op1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op2</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">op1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">op2</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_compare_dtypes</span><span class="p">(</span><span class="n">op1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">op2</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Checks whether the data types of op1 and op2 are compatible with each other.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        op1</span>
<span class="sd">            First operator.</span>
<span class="sd">        op2</span>
<span class="sd">            Second operator.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            If true, the data types of op1 and op2 are compatible.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">op1</span> <span class="o">+</span> <span class="n">op2</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op1</span><span class="p">,</span> <span class="s1">&#39;dtype&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op2</span><span class="p">,</span> <span class="s1">&#39;dtype&#39;</span><span class="p">):</span>
                <span class="n">dtype1</span> <span class="o">=</span> <span class="n">op1</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">as_numpy_dtype</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op1</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;as_numpy_dtype&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">op1</span><span class="o">.</span><span class="n">dtype</span>
                <span class="n">dtype2</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">as_numpy_dtype</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;as_numpy_dtype&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">op2</span><span class="o">.</span><span class="n">dtype</span>
                <span class="k">return</span> <span class="n">dtype1</span> <span class="o">==</span> <span class="n">dtype2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span></div>
</pre></div>

          </div>
        </div>
          </div>
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/pyrates_logo.png" alt="Logo">
            </a></p>

        </div>
      </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2020, Richard Gast and Daniel Rose.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 3.1.1.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>