
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pyrates.utility.filestorage &#8212; PyRates 0.7.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <h1>Source code for pyrates.utility.filestorage</h1><div class="highlight"><pre>
<span></span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># PyRates software framework for flexible implementation of neural </span>
<span class="c1"># network model_templates and simulations. See also:</span>
<span class="c1"># https://github.com/pyrates-neuroscience/PyRates</span>
<span class="c1"># </span>
<span class="c1"># Copyright (C) 2017-2018 the original authors (Richard Gast and </span>
<span class="c1"># Daniel Rose), the Max-Planck-Institute for Human Cognitive Brain </span>
<span class="c1"># Sciences (&quot;MPI CBS&quot;) and contributors</span>
<span class="c1"># </span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1"># </span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1"># </span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;</span>
<span class="c1"># </span>
<span class="c1"># CITATION:</span>
<span class="c1"># </span>
<span class="c1"># Richard Gast and Daniel Rose et. al. in preparation</span>
<span class="sd">&quot;&quot;&quot; Utility functions to store Circuit configurations and data in JSON files</span>
<span class="sd">and read/construct circuit from JSON.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># external packages</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">networkx</span> <span class="k">import</span> <span class="n">node_link_data</span>
<span class="c1"># from typing import Union, List</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">getsource</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">DataFrame</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># meta infos</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Daniel Rose&quot;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s2">&quot;Development&quot;</span>

<span class="c1"># TODO: Update documentations &amp; clean functions from unnecessary comments (i.e. silent code)</span>


<div class="viewcode-block" id="CustomEncoder"><a class="viewcode-back" href="../../../pyrates.utility.html#pyrates.utility.filestorage.CustomEncoder">[docs]</a><span class="k">class</span> <span class="nc">CustomEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
<div class="viewcode-block" id="CustomEncoder.default"><a class="viewcode-back" href="../../../pyrates.utility.html#pyrates.utility.filestorage.CustomEncoder.default">[docs]</a>    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="c1"># from pyrates.population import Population</span>
        <span class="c1"># from pyrates.synapse import Synapse</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;to_json&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="c1"># elif isinstance(obj, Synapse):</span>
        <span class="c1">#     attr_dict = obj.to_dict()</span>
        <span class="c1">#     # remove synaptic_kernel from dict, if kernel_function is specified</span>
        <span class="c1">#     if &quot;kernel_function&quot; in attr_dict:</span>
        <span class="c1">#       JansenRitCircuit  attr_dict.pop(&quot;synaptic_kernel&quot;, None)</span>
        <span class="c1">#     return attr_dict</span>
        <span class="c1"># elif isinstance(obj, Axon):</span>
        <span class="c1">#     return get_attrs(obj)</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">getsource</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="RepresentationBase"><a class="viewcode-back" href="../../../pyrates.utility.html#pyrates.utility.filestorage.RepresentationBase">[docs]</a><span class="k">class</span> <span class="nc">RepresentationBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class that implements a __repr__ that yields the __init__ function signature with provided arguments in the</span>
<span class="sd">    form &#39;module.Class(arg1, arg2, arg3)&#39;&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># noinspection PyArgumentList</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">_init_dict</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">_init_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span>

        <span class="n">instance</span><span class="o">.</span><span class="n">_init_dict</span> <span class="o">=</span> <span class="n">_init_dict</span>

        <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Magic method that returns to repr(object). It retrieves the signature of __init__ and maps it to class</span>
<span class="sd">        attributes to return a representation in the form &#39;module.Class(arg1=x, arg2=y, arg3=3)&#39;. Raises AttributeError,</span>
<span class="sd">        if the a parameter in the signature cannot be found (is not saved). The current implementation &quot;&quot;&quot;</span>

        <span class="c1"># repr_str = f&quot;{self.__module__!r}.{self.__class__!r}(&quot;</span>
        <span class="c1"># params = self._get_params()</span>
        <span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">copy</span>
        <span class="n">init_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_dict</span><span class="p">)</span>

        <span class="c1"># args = &quot;&quot;</span>
        <span class="c1"># if &quot;args&quot; in init_dict:</span>
        <span class="c1">#     args = init_dict.pop(&quot;args&quot;, None)</span>
        <span class="c1">#     args = &quot;, &quot;.join((f&quot;{value!r}&quot; for value in args))</span>
        <span class="c1">#</span>
        <span class="c1"># kwargs = &quot;, &quot;.join((f&quot;{name}={value!r}&quot; for name, value in init_dict.items()))</span>
        <span class="c1"># param_str = f&quot;{args}, {kwargs}&quot;</span>
        <span class="n">param_str</span> <span class="o">=</span> <span class="s2">&quot;*args, **kwargs&quot;</span>
        <span class="n">_module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="c1"># return f&quot;{_module}.{_class}({param_str})&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{_class}</span><span class="s2"> &#39;</span><span class="si">{self.key}</span><span class="s2">&#39;&quot;</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{_class}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Inspects the __init__ special method and yields tuples of init parameters and their default values.&quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">inspect</span>

        <span class="c1"># retrieve signature of __init__ method</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>

        <span class="c1"># retrieve parameters in the signature</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># check if param has a default value</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="o">!=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">):</span>
                <span class="c1"># yield parameter name and default value</span>
                <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>

<div class="viewcode-block" id="RepresentationBase.to_dict"><a class="viewcode-back" href="../../../pyrates.utility.html#pyrates.utility.filestorage.RepresentationBase.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_defaults</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_graph</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Parse representation string to a dictionary to later convert it to json.&quot;&quot;&quot;</span>

        <span class="n">_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">_dict</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;__module__&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">}</span>
        <span class="c1"># _dict[&quot;module&quot;] = self.__class__.__module__</span>
        <span class="c1"># _dict[&quot;class&quot;] = self.__class__.__name__</span>

        <span class="c1"># obtain parameters that were originally passed to __init__</span>
        <span class="c1">###########################################################</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># include defaults of parameters that were not specified when __init__ was called.</span>
        <span class="c1">##################################################################################</span>

        <span class="k">if</span> <span class="n">include_defaults</span><span class="p">:</span>
            <span class="n">default_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_dict</span><span class="p">:</span>  <span class="c1"># this fails to get positional arguments that override defaults to keyword args</span>
                    <span class="n">default_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">_dict</span><span class="p">[</span><span class="s2">&quot;defaults&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_dict</span>

        <span class="c1"># Include graph if desired</span>
        <span class="c1">##########################</span>

        <span class="c1"># check if it quacks like a duck... eh.. has a network_graph like a circuit</span>
        <span class="k">if</span> <span class="n">include_graph</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;network_graph&quot;</span><span class="p">):</span>
            <span class="n">net_dict</span> <span class="o">=</span> <span class="n">node_link_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_graph</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">net_dict</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]:</span>
                    <span class="n">node</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">include_defaults</span><span class="o">=</span><span class="n">include_defaults</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">_dict</span><span class="p">[</span><span class="s2">&quot;network_graph&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_dict</span>

        <span class="c1"># Apply dict transformation recursively to all relevant objects</span>
        <span class="c1">###############################################################</span>

        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># check if it quacks like a duck... eh.. represents like a RepresentationBase</span>
                <span class="c1"># note, however, that &quot;to_dict&quot; is actually implemented by a number of objects outside this codebase</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;to_dict&quot;</span><span class="p">):</span>
                    <span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">include_defaults</span><span class="o">=</span><span class="n">include_defaults</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_dict</span></div>

<div class="viewcode-block" id="RepresentationBase.to_json"><a class="viewcode-back" href="../../../pyrates.utility.html#pyrates.utility.filestorage.RepresentationBase.to_json">[docs]</a>    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_defaults</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_graph</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse a dictionary into &quot;&quot;&quot;</span>

        <span class="c1"># from pyrates.utility.json_filestorage import CustomEncoder</span>

        <span class="n">_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">include_defaults</span><span class="o">=</span><span class="n">include_defaults</span><span class="p">,</span> <span class="n">include_graph</span><span class="o">=</span><span class="n">include_graph</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">os</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

            <span class="c1"># create directory if necessary</span>
            <span class="n">create_directory</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">):</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{filepath}</span><span class="s2">.json&quot;</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">_dict</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">CustomEncoder</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># return json as string</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_dict</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">CustomEncoder</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="get_simulation_data"><a class="viewcode-back" href="../../../pyrates.utility.html#pyrates.utility.filestorage.get_simulation_data">[docs]</a><span class="k">def</span> <span class="nf">get_simulation_data</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">state_variable</span><span class="o">=</span><span class="s1">&#39;membrane_potential&#39;</span><span class="p">,</span> <span class="n">pop_keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">time_window</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Obtain all simulation data from a circuit, including run parameters&quot;&quot;&quot;</span>

    <span class="n">run_info</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">run_info</span>
    <span class="n">states</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">get_population_states</span><span class="p">(</span><span class="n">state_variable</span><span class="o">=</span><span class="n">state_variable</span><span class="p">,</span> <span class="n">population_keys</span><span class="o">=</span><span class="n">pop_keys</span><span class="p">,</span>
                                           <span class="n">time_window</span><span class="o">=</span><span class="n">time_window</span><span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">pop</span> <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">circuit</span><span class="o">.</span><span class="n">populations</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;dummy&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">]</span>

    <span class="n">states</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">states</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">run_info</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">run_info</span><span class="p">,</span> <span class="n">states</span></div>


<div class="viewcode-block" id="save_simulation_data_to_file"><a class="viewcode-back" href="../../../pyrates.utility.html#pyrates.utility.filestorage.save_simulation_data_to_file">[docs]</a><span class="k">def</span> <span class="nf">save_simulation_data_to_file</span><span class="p">(</span><span class="n">output_data</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">run_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                                 <span class="n">dirname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">out_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save simulation output and inputs that were given to the run function to a file.&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">os</span>

    <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dirname</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>

    <span class="c1"># create directory if necessary</span>
    <span class="n">create_directory</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>

    <span class="c1"># save output data</span>
    <span class="c1">##################</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;output.</span><span class="si">{out_format}</span><span class="s2">&quot;</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out_format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="n">output_data</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;split&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">out_format</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
        <span class="n">output_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Unknown output format &#39;</span><span class="si">{out_format}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># save run information</span>
    <span class="c1">######################</span>

    <span class="k">if</span> <span class="s2">&quot;time_vector&quot;</span> <span class="ow">in</span> <span class="n">run_info</span><span class="p">:</span>
        <span class="c1"># throw away time vector, since it is contained in all the other data</span>
        <span class="n">run_info</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;time_vector&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">run_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{key}</span><span class="s2">.</span><span class="si">{out_format}</span><span class="s2">&quot;</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">out_format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;split&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># TODO: think about float vs. decimal representation: Possibly save float data as hex or fraction</span>
    <span class="c1"># TODO: choose time update as exact float (e.g. 0.0005 --&gt; 2**-11=0.00048828125)</span>


<div class="viewcode-block" id="create_directory"><a class="viewcode-back" href="../../../pyrates.utility.html#pyrates.utility.filestorage.create_directory">[docs]</a><span class="k">def</span> <span class="nf">create_directory</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;check if a directory exists and create it otherwise&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">errno</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># Guard against race condition</span>
            <span class="k">if</span> <span class="n">exc</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EEXIST</span><span class="p">:</span>
                <span class="k">raise</span></div>


<div class="viewcode-block" id="read_simulation_data_from_file"><a class="viewcode-back" href="../../../pyrates.utility.html#pyrates.utility.filestorage.read_simulation_data_from_file">[docs]</a><span class="k">def</span> <span class="nf">read_simulation_data_from_file</span><span class="p">(</span><span class="n">dirname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">filenames</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Read simulation data from files. The assumed data structure is:</span>
<span class="sd">    &lt;path&gt;/&lt;dirname&gt;/</span>
<span class="sd">        output.csv</span>
<span class="sd">        synaptic_inputs.csv</span>
<span class="sd">        extrinsic_current.csv</span>
<span class="sd">        extrinsic_modulation.csv</span>

<span class="sd">    This is the expected output from &#39;save_simulation_data_to_file&#39;, but if &#39;names&#39; is specified, other data</span>
<span class="sd">    may also be read.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">os</span>

    <span class="k">if</span> <span class="n">filenames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;synaptic_inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;extrinsic_current&quot;</span><span class="p">,</span> <span class="s2">&quot;extrinsic_modulation&quot;</span><span class="p">]</span>
        <span class="n">ignore_missing</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ignore_missing</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dirname</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">label</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_missing</span><span class="p">:</span>
                <span class="k">raise</span>

    <span class="k">return</span> <span class="n">data</span></div>
</pre></div>

          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../index.html">
    <img class="logo" src="../../../_static/PyRates_logo_color.png" alt="Logo"/>
    
    <h1 class="logo logo-name">PyRates</h1>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=pyrates-neuroscience&repo=PyRates&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/pyrates-neuroscience/PyRates">
    <img
        alt="https://secure.travis-ci.org/pyrates-neuroscience/PyRates.svg?branch=master"
        src="https://secure.travis-ci.org/pyrates-neuroscience/PyRates.svg?branch=master"
    />
</a>
</p>



<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Richard Gast, Daniel Rose, Christoph Salomon.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>